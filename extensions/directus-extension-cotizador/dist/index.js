import{useApi as t,useStores as n}from"@directus/extensions-sdk";import{computed as e,ref as r,onMounted as o,resolveComponent as a,openBlock as l,createBlock as i,withCtx as d,createVNode as c,createTextVNode as u,createCommentVNode as s,createElementVNode as p,createElementBlock as m,Fragment as b,renderList as f,toDisplayString as v,withDirectives as g,vModelText as h}from"vue";var w=[],x=[];!function(t,n){if(t&&"undefined"!=typeof document){var e,r=!0===n.prepend?"prepend":"append",o=!0===n.singleTag,a="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(o){var l=w.indexOf(a);-1===l&&(l=w.push(a)-1,x[l]={}),e=x[l]&&x[l][r]?x[l][r]:x[l][r]=i()}else e=i();65279===t.charCodeAt(0)&&(t=t.substring(1)),e.styleSheet?e.styleSheet.cssText+=t:e.appendChild(document.createTextNode(t))}function i(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),n.attributes)for(var e=Object.keys(n.attributes),o=0;o<e.length;o++)t.setAttribute(e[o],n.attributes[e[o]]);var l="prepend"===r?"afterbegin":"beforeend";return a.insertAdjacentElement(l,t),t}}("\n.iframe-container {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpadding: 0;\r\n\toverflow: hidden;\n}\n.cotizador-frame {\r\n\twidth: 100%;\r\n\theight: calc(100vh - 100px);\r\n\tborder: none;\n}\n.quotes-list {\r\n\tpadding: 8px;\n}\n.quote-item {\r\n\tpadding: 10px;\r\n\tmargin-bottom: 8px;\r\n\tbackground: var(--background-normal);\r\n\tborder-radius: 6px;\r\n\tcursor: pointer;\r\n\ttransition: background 0.2s;\n}\n.quote-item:hover {\r\n\tbackground: var(--background-normal-alt);\n}\n.quote-number {\r\n\tfont-weight: 600;\r\n\tcolor: var(--primary);\n}\n.quote-client {\r\n\tfont-size: 12px;\r\n\tcolor: var(--foreground-subdued);\r\n\tmargin-top: 2px;\n}\n.quote-total {\r\n\tfont-size: 13px;\r\n\tfont-weight: 500;\r\n\tmargin-top: 4px;\n}\n.loading, .empty {\r\n\ttext-align: center;\r\n\tpadding: 20px;\r\n\tcolor: var(--foreground-subdued);\n}\n.refresh-btn {\r\n\twidth: 100%;\r\n\tpadding: 8px;\r\n\tmargin-top: 10px;\r\n\tbackground: var(--background-normal);\r\n\tborder: 1px solid var(--border-normal);\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\r\n\tcolor: var(--foreground-normal);\n}\n.refresh-btn:hover {\r\n\tbackground: var(--background-normal-alt);\n}\n.main-content {\r\n\theight: 100%;\r\n\toverflow: auto;\n}\n.history-view {\r\n\tpadding: 20px;\n}\n.history-header {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 20px;\n}\n.history-header h2 {\r\n\tmargin: 0;\r\n\tcolor: var(--foreground-normal);\n}\n.refresh-btn-main {\r\n\tpadding: 8px 16px;\r\n\tbackground: var(--primary);\r\n\tcolor: white;\r\n\tborder: none;\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\n}\n.quotes-table {\r\n\twidth: 100%;\r\n\tborder-collapse: collapse;\n}\n.quotes-table th,\r\n.quotes-table td {\r\n\tpadding: 12px;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid var(--border-normal);\n}\n.quotes-table th {\r\n\tbackground: var(--background-normal);\r\n\tfont-weight: 600;\r\n\tcolor: var(--foreground-subdued);\n}\n.quotes-table tr:hover {\r\n\tbackground: var(--background-normal);\n}\n.quote-num {\r\n\tfont-weight: 600;\r\n\tcolor: var(--primary);\n}\n.action-btn {\r\n\tpadding: 4px 12px;\r\n\tbackground: var(--background-normal);\r\n\tborder: 1px solid var(--border-normal);\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\r\n\tcolor: var(--foreground-normal);\n}\n.action-btn:hover {\r\n\tbackground: var(--primary);\r\n\tcolor: white;\n}\n.action-btn.download {\r\n\tmargin-left: 4px;\n}\n.filters-section {\r\n\tbackground: var(--background-normal);\r\n\tpadding: 16px;\r\n\tborder-radius: 8px;\r\n\tmargin-bottom: 16px;\n}\n.filter-row {\r\n\tdisplay: flex;\r\n\tflex-wrap: wrap;\r\n\tgap: 16px;\r\n\talign-items: flex-end;\n}\n.filter-group {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tgap: 4px;\n}\n.filter-group label {\r\n\tfont-size: 12px;\r\n\tcolor: var(--foreground-subdued);\r\n\tfont-weight: 500;\n}\n.filter-input {\r\n\tpadding: 8px 12px;\r\n\tborder: 1px solid var(--border-normal);\r\n\tborder-radius: 4px;\r\n\tbackground: var(--background-page);\r\n\tcolor: var(--foreground-normal);\r\n\tmin-width: 150px;\n}\n.filter-input:focus {\r\n\toutline: none;\r\n\tborder-color: var(--primary);\n}\n.filter-actions {\r\n\tdisplay: flex;\r\n\tgap: 8px;\n}\n.btn-primary {\r\n\tpadding: 8px 16px;\r\n\tbackground: var(--primary);\r\n\tcolor: white;\r\n\tborder: none;\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\r\n\tfont-weight: 500;\n}\n.btn-primary:hover {\r\n\topacity: 0.9;\n}\n.btn-secondary {\r\n\tpadding: 8px 16px;\r\n\tbackground: var(--background-normal-alt);\r\n\tcolor: var(--foreground-normal);\r\n\tborder: 1px solid var(--border-normal);\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\n}\n.btn-secondary:hover {\r\n\tbackground: var(--background-normal);\n}\n.btn-download {\r\n\tpadding: 8px 16px;\r\n\tbackground: #10b981;\r\n\tcolor: white;\r\n\tborder: none;\r\n\tborder-radius: 4px;\r\n\tcursor: pointer;\r\n\tfont-weight: 500;\n}\n.btn-download:hover {\r\n\tbackground: #059669;\n}\n.results-info {\r\n\tpadding: 8px 12px;\r\n\tbackground: var(--background-normal);\r\n\tborder-radius: 4px;\r\n\tmargin-bottom: 12px;\r\n\tfont-size: 13px;\r\n\tcolor: var(--foreground-subdued);\n}\r\n",{});var y=(t,n)=>{const e=t.__vccOpts||t;for(const[t,r]of n)e[t]=r;return e};const k={setup(){const a=t(),{useUserStore:l}=n(),i=l(),d=e(()=>i.currentUser),c=r([]),u=r([]),s=r(!1),p=r("new"),m=r(""),b=r(""),f=r(""),v=e(()=>{const t=d.value;return t&&(t.role?.admin_access||t.admin_access)||!1}),g=e(()=>u.value.reduce((t,n)=>t+Number(n.total||0),0)),h="localhost"===window.location.hostname?"http://localhost:5173":`${window.location.protocol}//${window.location.hostname}:5173`,w=e(()=>{if(!d.value)return null;const t=new URLSearchParams({user_id:d.value.id,email:d.value.email||"",name:`${d.value.first_name||""} ${d.value.last_name||""}`.trim(),phone:d.value.phone||d.value.telefono||""});return`${h}?${t.toString()}`});async function x(){s.value=!0;try{const t=await a.get("/items/cotizaciones",{params:{limit:100,sort:["-created_at"],fields:["id","numero","year","cliente_nombre","proyecto","total","created_at","archivo_path"]}});c.value=t.data.data||[],u.value=c.value}catch(t){console.error("Error loading quotes:",t),c.value=[],u.value=[]}finally{s.value=!1}}function y(t){return Number(t||0).toFixed(2)}function k(t){if(!t)return"-";return new Date(t).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}return o(()=>{x()}),{userURL:w,quotes:c,filteredQuotes:u,loading:s,currentView:p,isAdmin:v,totalSum:g,searchText:m,dateFrom:b,dateTo:f,loadQuotes:x,loadQuotesFiltered:function(){let t=[...c.value];if(m.value){const n=m.value.toLowerCase();t=t.filter(t=>(t.cliente_nombre||"").toLowerCase().includes(n)||(t.proyecto||"").toLowerCase().includes(n)||(t.numero||"").toLowerCase().includes(n))}if(b.value){const n=new Date(b.value);t=t.filter(t=>new Date(t.created_at)>=n)}if(f.value){const n=new Date(f.value);n.setHours(23,59,59),t=t.filter(t=>new Date(t.created_at)<=n)}u.value=t},clearFilters:function(){m.value="",b.value="",f.value="",u.value=c.value},downloadReport:function(){const t=u.value.map(t=>[`${t.numero}-${String(t.year).slice(-2)}`,t.cliente_nombre||"",t.proyecto||"",y(t.total),k(t.created_at)]);let n=["NÂ° CotizaciÃ³n","Cliente","Proyecto","Total","Fecha"].join(",")+"\n";t.forEach(t=>{n+=t.map(t=>`"${t}"`).join(",")+"\n"}),n+=`\n"Total","","","${y(g.value)}",""`;const e=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),o=document.createElement("a");o.href=r;const a=(new Date).toISOString().slice(0,10);o.download=`cotizaciones_${a}.csv`,o.click(),URL.revokeObjectURL(r)},downloadQuote:function(t){t.archivo_path?window.open(`http://localhost:8000/download/${t.year}/${t.numero}`,"_blank"):alert("No hay archivo disponible para esta cotizaciÃ³n")},formatNumber:y,formatDate:k,openQuote:function(t){window.open(`/admin/content/cotizaciones/${t.id}`,"_blank")},openDirectusCollection:function(){window.location.href="/admin/content/cotizaciones"}}}},_={class:"quotes-list"},C={key:0,class:"loading"},q={key:1,class:"empty"},z={key:2},Q=["onClick"],F={class:"quote-number"},S={class:"quote-client"},N={class:"quote-total"},L={class:"main-content"},T={key:0,class:"iframe-container"},$=["src"],D={class:"history-view"},R={class:"filters-section"},U={class:"filter-row"},V={class:"filter-group"},A={class:"filter-group"},j={class:"filter-group"},E={class:"filter-actions"},O={key:0,class:"results-info"},H={key:0},B={key:1,class:"loading"},P={key:2,class:"empty"},I={key:3,class:"quotes-table"},M={class:"quote-num"},G={class:"quote-total"},J=["onClick"],K=["onClick"];var W={id:"cotizador",name:"Cotizador",icon:"calculator",routes:[{path:"",component:y(k,[["render",function(t,n,e,r,o,w){const x=a("v-icon"),y=a("v-list-item-icon"),k=a("v-list-item-content"),W=a("v-list-item"),X=a("v-list"),Y=a("sidebar-detail"),Z=a("private-view");return l(),i(Z,{title:"Cotizador de Ventas"},{navigation:d(()=>[c(X,{nav:""},{default:d(()=>[c(W,{active:"new"===r.currentView,onClick:n[0]||(n[0]=t=>r.currentView="new"),clickable:""},{default:d(()=>[c(y,null,{default:d(()=>[c(x,{name:"add_circle"})]),_:1}),c(k,null,{default:d(()=>[...n[12]||(n[12]=[u("Nueva CotizaciÃ³n",-1)])]),_:1})]),_:1},8,["active"]),c(W,{active:"list"===r.currentView,onClick:n[1]||(n[1]=t=>{r.currentView="list",r.loadQuotesFiltered()}),clickable:""},{default:d(()=>[c(y,null,{default:d(()=>[c(x,{name:"list_alt"})]),_:1}),c(k,null,{default:d(()=>[...n[13]||(n[13]=[u("Historial",-1)])]),_:1})]),_:1},8,["active"]),r.isAdmin?(l(),i(W,{key:0,clickable:"",onClick:r.openDirectusCollection},{default:d(()=>[c(y,null,{default:d(()=>[c(x,{name:"table_chart"})]),_:1}),c(k,null,{default:d(()=>[...n[14]||(n[14]=[u("Administrar",-1)])]),_:1})]),_:1},8,["onClick"])):s("v-if",!0)]),_:1})]),sidebar:d(()=>[c(Y,{icon:"receipt_long",title:"Cotizaciones Recientes"},{default:d(()=>[p("div",_,[r.loading?(l(),m("div",C,"Cargando...")):0===r.quotes.length?(l(),m("div",q,"No hay cotizaciones")):(l(),m("div",z,[(l(!0),m(b,null,f(r.quotes,t=>(l(),m("div",{key:t.id,class:"quote-item",onClick:n=>r.openQuote(t)},[p("div",F,v(t.numero)+"-"+v(String(t.year).slice(-2)),1),p("div",S,v(t.cliente_nombre||"Sin cliente"),1),p("div",N,"S/ "+v(r.formatNumber(t.total)),1)],8,Q))),128))])),p("button",{class:"refresh-btn",onClick:n[2]||(n[2]=(...t)=>r.loadQuotes&&r.loadQuotes(...t))}," â†» Actualizar ")])]),_:1})]),default:d(()=>[p("div",L,[s(" Nueva CotizaciÃ³n (iframe) "),"new"===r.currentView?(l(),m("div",T,[r.userURL?(l(),m("iframe",{key:0,src:r.userURL,class:"cotizador-frame",frameborder:"0"},null,8,$)):s("v-if",!0)])):"list"===r.currentView?(l(),m(b,{key:1},[s(" Historial de cotizaciones "),p("div",D,[n[19]||(n[19]=p("div",{class:"history-header"},[p("h2",null,"Historial de Cotizaciones")],-1)),s(" Filtros "),p("div",R,[p("div",U,[p("div",V,[n[15]||(n[15]=p("label",null,"Buscar:",-1)),g(p("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=t=>r.searchText=t),placeholder:"Cliente, proyecto, nÃºmero...",class:"filter-input",onInput:n[4]||(n[4]=(...t)=>r.loadQuotesFiltered&&r.loadQuotesFiltered(...t))},null,544),[[h,r.searchText]])]),p("div",A,[n[16]||(n[16]=p("label",null,"Desde:",-1)),g(p("input",{type:"date","onUpdate:modelValue":n[5]||(n[5]=t=>r.dateFrom=t),class:"filter-input",onChange:n[6]||(n[6]=(...t)=>r.loadQuotesFiltered&&r.loadQuotesFiltered(...t))},null,544),[[h,r.dateFrom]])]),p("div",j,[n[17]||(n[17]=p("label",null,"Hasta:",-1)),g(p("input",{type:"date","onUpdate:modelValue":n[7]||(n[7]=t=>r.dateTo=t),class:"filter-input",onChange:n[8]||(n[8]=(...t)=>r.loadQuotesFiltered&&r.loadQuotesFiltered(...t))},null,544),[[h,r.dateTo]])]),p("div",E,[p("button",{class:"btn-primary",onClick:n[9]||(n[9]=(...t)=>r.loadQuotesFiltered&&r.loadQuotesFiltered(...t))},"ðŸ” Buscar"),p("button",{class:"btn-secondary",onClick:n[10]||(n[10]=(...t)=>r.clearFilters&&r.clearFilters(...t))},"âœ• Limpiar"),p("button",{class:"btn-download",onClick:n[11]||(n[11]=(...t)=>r.downloadReport&&r.downloadReport(...t))},"ðŸ“¥ Descargar")])])]),s(" Resultados "),r.filteredQuotes.length>0?(l(),m("div",O,[u(" Mostrando "+v(r.filteredQuotes.length)+" cotizaciones ",1),r.totalSum>0?(l(),m("span",H," | Total: S/ "+v(r.formatNumber(r.totalSum)),1)):s("v-if",!0)])):s("v-if",!0),r.loading?(l(),m("div",B,"Cargando...")):0===r.filteredQuotes.length?(l(),m("div",P,"No hay cotizaciones con estos filtros")):(l(),m("table",I,[n[18]||(n[18]=p("thead",null,[p("tr",null,[p("th",null,"NÂ° CotizaciÃ³n"),p("th",null,"Cliente"),p("th",null,"Proyecto"),p("th",null,"Total"),p("th",null,"Fecha"),p("th",null,"Acciones")])],-1)),p("tbody",null,[(l(!0),m(b,null,f(r.filteredQuotes,t=>(l(),m("tr",{key:t.id},[p("td",M,v(t.numero)+"-"+v(String(t.year).slice(-2)),1),p("td",null,v(t.cliente_nombre||"-"),1),p("td",null,v(t.proyecto||"-"),1),p("td",G,"S/ "+v(r.formatNumber(t.total)),1),p("td",null,v(r.formatDate(t.created_at)),1),p("td",null,[p("button",{class:"action-btn",onClick:n=>r.openQuote(t)},"Ver",8,J),p("button",{class:"action-btn download",onClick:n=>r.downloadQuote(t)},"ðŸ“¥",8,K)])]))),128))])]))])],2112)):s("v-if",!0)])]),_:1})}],["__file","module.vue"]])}]};export{W as default};
